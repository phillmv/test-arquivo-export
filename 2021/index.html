<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='ie=edge' />
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <title></title>
    <link href="/test-middleman-actions/stylesheets/site.css" rel="stylesheet" />
    <script src="/test-middleman-actions/javascripts/site.js"></script>
  </head>
  <body>

    <div class="container-xl clearfix pt-1">
      <div class="sidebar-container">
        &nbsp;
      </div>
      <div class="content-container">
            2021
 

  <div class="entry-box entry-show">
  <div class="Box-body border-0 markdown-body js-task-list-container">
    <div class="entry-body">
      <div class="mb-3">

        <a href="/test-middleman-actions/20210118103133-pj9r/" class="Box-btn-octicon btn-octicon f4">
          <svg class="octicon octicon-link mr-1 v-visible" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>2021-01-18 10:31:33 -0500
        </a>
      </div>
      <p data-sourcepos="1:1-1:156">been working on a middleman compilation github action to automatically convert arquivo entries into static webpages so i can share my notes with colleagues.</p>
<p data-sourcepos="3:1-3:32">let's call this……<a href="/test-middleman-actions/tags/webexport/"> #webexport</a></p>
<p data-sourcepos="5:1-5:107">the idea is that it would also make it super easy to create a tumblelog / mood board directly from arquivo.</p>
<p data-sourcepos="7:1-7:208">i've gotten quite far; i've exported the stylesheet, the layout, the precise markdown settings i use here. remaining step i think is converting directly from arquivo entry yaml to middleman blog post entries.</p>
<p data-sourcepos="9:1-9:174">one way to achieve this would be a simple converter - dir[*] across the yaml files and output new entries - but why do that when i could just have it read the files directly?</p>
<p data-sourcepos="11:1-11:45">/me goes looking inside the guts of middleman</p>
    </div>
  </div>
</div>

  <div class="entry-box entry-show">
  <div class="Box-body border-0 markdown-body js-task-list-container">
    <div class="entry-body">
      <div class="mb-3">

        <a href="/test-middleman-actions/20210109160430-53gj/" class="Box-btn-octicon btn-octicon f4">
          <svg class="octicon octicon-link mr-1 v-visible" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>2021-01-09 16:04:30 -0500
        </a>
      </div>
      <p data-sourcepos="1:1-1:9"><a href="/test-middleman-actions/tags/gitsync/">#gitsync</a></p>
<ul data-sourcepos="3:1-3:67">
<li data-sourcepos="3:1-3:67">git pull needs to look up current branch / not assume it's master</li>
</ul>
    </div>
  </div>
</div>

  <div class="entry-box entry-show">
  <div class="Box-body border-0 markdown-body js-task-list-container">
    <div class="entry-body">
      <div class="mb-3">

        <a href="/test-middleman-actions/20210109141550-hj7p/" class="Box-btn-octicon btn-octicon f4">
          <svg class="octicon octicon-link mr-1 v-visible" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>2021-01-09 14:15:50 -0500
        </a>
      </div>
      <p data-sourcepos="1:1-1:9"><a href="/test-middleman-actions/tags/gitsync/">#gitsync</a></p>
<p data-sourcepos="3:1-3:35">last time i got basic sync working:</p>
<ul data-sourcepos="5:1-6:0">
<li data-sourcepos="5:1-6:0">can pull, and resolve conflicts</li>
</ul>
<p data-sourcepos="7:1-7:65">but they're not run automatically and not yet tied together, i.e.</p>
<ul data-sourcepos="9:1-14:0">
<li data-sourcepos="9:1-9:39">doesn't auto push on a background job</li>
<li data-sourcepos="10:1-10:39">doesn't auto pull on a background job</li>
<li data-sourcepos="11:1-11:23">does it auto resolve?</li>
<li data-sourcepos="12:1-12:42">needs to have the remote be configurable</li>
<li data-sourcepos="13:1-14:0">lots of clean up around instantiating a new repo</li>
</ul>
<p data-sourcepos="15:1-15:34">and look at that the boy is awake!</p>
    </div>
  </div>
</div>

  <div class="entry-box entry-show">
  <div class="Box-body border-0 markdown-body js-task-list-container">
    <div class="entry-body">
      <div class="mb-3">

        <a href="/test-middleman-actions/20210109135948-mg7c/" class="Box-btn-octicon btn-octicon f4">
          <svg class="octicon octicon-link mr-1 v-visible" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>2021-01-09 13:59:48 -0500
        </a>
      </div>
      <p data-sourcepos="1:1-1:32">i might have a whole ten minutes</p>
    </div>
  </div>
</div>

  <div class="entry-box entry-show">
  <div class="Box-body border-0 markdown-body js-task-list-container">
    <div class="entry-body">
      <div class="mb-3">

        <a href="/test-middleman-actions/20210103133700-c6j5/" class="Box-btn-octicon btn-octicon f4">
          <svg class="octicon octicon-link mr-1 v-visible" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>2021-01-03 13:37:00 -0500
        </a>
      </div>
      <p data-sourcepos="1:1-1:9"><a href="/test-middleman-actions/tags/gitsync/">#gitsync</a></p>
<p data-sourcepos="3:1-3:94">:thinking: should have some sort of verification that we're actually adjudicating two entries.</p>
<pre data-sourcepos="5:1-18:3"><code>require 'pry'
require 'yaml'

ours = YAML.load_file(ARGV[1])["updated_at"]
theirs = YAML.load_file(ARGV[2])["updated_at"]

if ours &lt; theirs
  FileUtils.cp(ARGV[2], ARGV[1])
end

FileUtils.cp(winner[1], ARGV[1]) unless winner == ARGV[1]
exit 0
</code></pre>
    </div>
  </div>
</div>

  <div class="entry-box entry-show">
  <div class="Box-body border-0 markdown-body js-task-list-container">
    <div class="entry-body">
      <div class="mb-3">

        <a href="/test-middleman-actions/20210102133703-3479/" class="Box-btn-octicon btn-octicon f4">
          <svg class="octicon octicon-link mr-1 v-visible" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>2021-01-02 13:37:03 -0500
        </a>
      </div>
      <p data-sourcepos="1:1-1:9"><a href="/test-middleman-actions/tags/gitsync/">#gitsync</a></p>
<p data-sourcepos="3:1-3:10">git/config</p>
<pre data-sourcepos="4:1-9:3"><code>[merge "last-in-wins"]
  name = last in wins
  driver = /usr/local/bin/chruby-exec ruby-2.6.5 -- ruby /tmp/merger.rb %O %A %B %L %P
  recursive = text
</code></pre>
<p data-sourcepos="11:1-11:70"><a href="https://git-scm.com/docs/gitattributes#_defining_a_custom_merge_driver">https://git-scm.com/docs/gitattributes#_defining_a_custom_merge_driver</a></p>
<p data-sourcepos="13:1-13:23">also git pull --no-edit</p>
<p data-sourcepos="15:1-15:47">(gotta write the winner to the location in <code>%A</code></p>
<pre data-sourcepos="16:1-28:3"><code>require 'pry'
require 'yaml'
require 'active_support/time_with_zone'

ours = [YAML.load_file(ARGV[1]), ARGV[1]]
theirs = [YAML.load_file(ARGV[2]), ARGV[2]]

winner = [ours,theirs].sort_by { |attr, file| attr["updated_at"] }.last[1]

FileUtils.cp(winner[1], ARGV[1]) unless winner == ARGV[1]
exit 0
</code></pre>
<p data-sourcepos="30:1-30:18">issues to resolve:</p>
<p data-sourcepos="32:1-33:50">auto installing this custom merger in the git repos<br>
reliably fucking executing it jfc is another issue</p>
<p data-sourcepos="35:1-35:93"><a href="https://stackoverflow.com/questions/7607125/git-merge-conflict-to-always-take-the-newest-file">https://stackoverflow.com/questions/7607125/git-merge-conflict-to-always-take-the-newest-file</a></p>
<pre data-sourcepos="37:1-50:3"><code>#!/bin/sh
if git merge-file -p -q "$2" "$1" "$3" &gt; /dev/null;
        then git merge-file "$2" "$1" "$3";
        else
                MINE=$(git log --format="%ct" --no-merges "$6" -1 $5);
                THEIRS=$(git log --format="%ct" --no-merges "$7" -1 $5);
                if [ $MINE -gt $THEIRS ]; then
                  git merge-file -q --ours "$2" "$1" "$3" &gt;/dev/null
                else
                  git merge-file -q --theirs "$2" "$1" "$3"&gt;/dev/null
                fi
fi
</code></pre>
<p data-sourcepos="52:1-52:42"><code>git-merge-newest %O %A %B %L %P $HEAD $1</code></p>
<pre data-sourcepos="54:1-59:3"><code>[merge "newest"]
  name = foo
  driver = /usr/local/bin/chruby-exec ruby-2.6.5 -- ruby /tmp/pry.rb %O %A %B %L %P `git rev-parse --abbrev-ref HEAD` $1
  recursive = text
</code></pre>
<hr data-sourcepos="61:1-62:0">
<p data-sourcepos="63:1-63:34">okay so i have a few options here.</p>
<p data-sourcepos="65:1-65:65">i need to run merge and if it conflicts pick the most recent one.</p>
<ul data-sourcepos="67:1-73:0">
<li data-sourcepos="67:1-67:29">pick between ruby and shell</li>
<li data-sourcepos="68:1-73:0">pick between using git log time, file mtime, or entry updated_at
<ul data-sourcepos="69:3-73:0">
<li data-sourcepos="69:3-69:162">actually, <a href="https://git.wiki.kernel.org/index.php/GitFaq#Why_isn.27t_Git_preserving_modification_time_on_files.3F">looks like file mtime in git is unreliable</a>?</li>
<li data-sourcepos="70:3-70:72">problem: git log time only has second resolution, which breaks tests</li>
<li data-sourcepos="71:3-73:0">on the other time, could just use ruby
<ul data-sourcepos="72:5-73:0">
<li data-sourcepos="72:5-73:0">problem there: limited in what code can be used in ad hoc git repo installs. i.e. right now entry dumps depends on active_support/time_with_zone</li>
</ul>
</li>
</ul>
</li>
</ul>
<p data-sourcepos="74:1-74:132">might have to redo how entry yaml is generated to eschew time_with_zone, so that i can just <code>require 'yaml'</code> in a quick shell script</p>
    </div>
  </div>
</div>

  <div class="entry-box entry-show">
  <div class="Box-body border-0 markdown-body js-task-list-container">
    <div class="entry-body">
      <div class="mb-3">

        <a href="/test-middleman-actions/20210102074115-w645/" class="Box-btn-octicon btn-octicon f4">
          <svg class="octicon octicon-link mr-1 v-visible" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>2021-01-02 07:41:15 -0500
        </a>
      </div>
      <p data-sourcepos="1:1-1:9"><a href="/test-middleman-actions/tags/gitsync/">#gitsync</a></p>
<p data-sourcepos="3:1-3:46">successfully split classes out as named above.</p>
<p data-sourcepos="5:1-5:230">while writing it out, realized that the SyncWithGit class was being called from SyncFromDisk. This makes sense in a dropbox import method, but broke a test because some yaml was re-serialized slightly differently and broke a test.</p>
<p data-sourcepos="7:1-7:14">(note to self:</p>
<ul data-sourcepos="8:1-9:0" class="task-list">
<li data-sourcepos="8:1-9:0" class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" checked disabled> test entry.to_yaml -&gt; disk -&gt; from yaml -&gt; to disk interaction, assert no changes if possible</li>
</ul>
<p data-sourcepos="10:1-10:1">)</p>
<p data-sourcepos="12:1-12:171">i think i now can finally work on the git interaction, separately from committing an individual entry. git pull - but there's a conflict. git push, but there's a conflict.</p>
    </div>
  </div>
</div>

  <div class="entry-box entry-show">
  <div class="Box-body border-0 markdown-body js-task-list-container">
    <div class="entry-body">
      <div class="mb-3">

        <a href="/test-middleman-actions/20210102072319-m7v4/" class="Box-btn-octicon btn-octicon f4">
          <svg class="octicon octicon-link mr-1 v-visible" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>2021-01-02 07:23:19 -0500
        </a>
      </div>
      <p data-sourcepos="1:1-1:7"><a href="/test-middleman-actions/tags/ideas/">#ideas</a></p>
<ul data-sourcepos="3:1-4:142">
<li data-sourcepos="3:1-3:68">Notebooks have a unique identifier to provide some auth on import.</li>
<li data-sourcepos="4:1-4:142">concept of this app as a kind of cms / publishing interface / public notebooks (and i guess, copying entries between notebooks as a feature)</li>
</ul>
    </div>
  </div>
</div>

  <div class="entry-box entry-show">
  <div class="Box-body border-0 markdown-body js-task-list-container">
    <div class="entry-body">
      <div class="mb-3">

        <a href="/test-middleman-actions/20210101142301-4xxf/" class="Box-btn-octicon btn-octicon f4">
          <svg class="octicon octicon-link mr-1 v-visible" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>2021-01-01 14:23:01 -0500
        </a>
      </div>
      <p data-sourcepos="1:1-1:9"><a href="/test-middleman-actions/tags/gitsync/">#gitsync</a></p>
<p data-sourcepos="3:1-3:78">ended up doing a lot of refactoring to the Importer, Exporter and LocalSyncer.</p>
<p data-sourcepos="5:1-5:63">An intuition I had: that maybe these classes should be renamed.</p>
<p data-sourcepos="7:1-7:217">The Exporter really is…………… <code>SyncDatabaseToDisk</code> or <code>SyncWithDisk</code> and the Importer really is <code>SyncDiskToDatabase</code> or <code>SyncWithDatabase</code>. The LocalSyncer is a <code>SyncWithGit</code> which in turn uses a <code>GitAdapter</code>.</p>
<p data-sourcepos="9:1-9:128">Maybe! Something like that. But then it becomes clear that the SyncWithGit has to call SyncWithDisk and then the GitAdapter etc.</p>
    </div>
  </div>
</div>



      </div>

      <!-- <aside> -->
      <!--   <h2>Recent Articles</h2> -->
      <!--   <ol> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/20210118103133-pj9r/"></a> <span>Jan 18</span></li> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/20210109160430-53gj/"></a> <span>Jan  9</span></li> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/20210109141550-hj7p/"></a> <span>Jan  9</span></li> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/20210109135948-mg7c/"></a> <span>Jan  9</span></li> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/20210103133700-c6j5/"></a> <span>Jan  3</span></li> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/20210102133703-3479/"></a> <span>Jan  2</span></li> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/20210102074115-w645/"></a> <span>Jan  2</span></li> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/20210102072319-m7v4/"></a> <span>Jan  2</span></li> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/20210101142301-4xxf/"></a> <span>Jan  1</span></li> -->
      <!--      -->
      <!--   </ol> -->
      <!--  -->
      <!--   <h2>Tags</h2> -->
      <!--   <ol> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/tags/gitsync/">#gitsync (6)</a></li> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/tags/webexport/">#webexport (1)</a></li> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/tags/ideas/">#ideas (1)</a></li> -->
      <!--      -->
      <!--   </ol> -->
      <!--  -->
      <!--   <h2>By Year</h2> -->
      <!--   <ol> -->
      <!--      -->
      <!--       <li><a href="/test-middleman-actions/2021/">2021 (9)</a></li> -->
      <!--      -->
      <!--   </ol> -->
      <!-- </aside> -->
    </div>
  </body>
</html>
